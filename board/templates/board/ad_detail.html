{# templates/board/ad_detail.html #}
{% extends 'board/base.html' %}
{% load static %}
{% block title %}{{ ad.–∑–∞–≥–æ–ª–æ–≤–æ–∫ }} ‚Äî –û–±—ä—è–≤–ª–µ–Ω–∏–µ{% endblock %}

{% block content %}

  <a href="{% url 'index' %}" class="back-link">&larr; –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
  <div class="ad-detail-card">

    {% if ad.–∫–∞—Ç–µ–≥–æ—Ä–∏—è.–Ω–∞–∑–≤–∞–Ω–∏–µ == "–ì–∏–¥" %}
	<h1>{{ ad.–∑–∞–≥–æ–ª–æ–≤–æ–∫ }}</h1>




	{# --- –í–û–¢ –°–Æ–î–ê! --- #}
	  {% if user.is_authenticated %}
		<form method="post" action="{% url 'toggle_favorite' ad.pk %}">
		  {% csrf_token %}
		  {% if user in ad.–∏–∑–±—Ä–∞–Ω–Ω–æ–µ.all %}
			<button class="btn-main" type="submit">‚òÖ –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º</button>
		  {% else %}
			<button class="btn-main" type="submit">‚òÜ –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
		  {% endif %}
		</form>
	  {% endif %}
	  
	  
	  
	  
      {# ‚Äî –¢–∞–±-–º–µ–Ω—é ‚Äî #}
      <div class="tabs" style="margin:24px 0;">
        <button class="tab-btn active" data-tab="info">–û –≥–∏–¥–µ</button>
        
        <button class="tab-btn" data-tab="reviews">–û—Ç–∑—ã–≤—ã</button>
      </div>

      {# --- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ì–∏–¥–∞ --- #}
      <div class="tab-content" id="tab-info">
        <h2>–û –≥–∏–¥–µ</h2>
        <div style="display:flex; gap:20px; margin-top:16px;">
          {% if ad.–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ %}
			  <img src="{{ ad.–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ_url }}" alt="–§–æ—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è" id="main-image" style="max-width:350px; cursor:zoom-in;" draggable="false">
		  {% endif %}
		  
          <div>
            <p><b>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</b> {{ ad.–∫–∞—Ç–µ–≥–æ—Ä–∏—è.–Ω–∞–∑–≤–∞–Ω–∏–µ }}</p>
            <p><b>–†–µ–≥–∏–æ–Ω:</b> {{ ad.—Ä–µ–≥–∏–æ–Ω }}</p>
            <p><b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b> {{ ad.–∫–æ–Ω—Ç–∞–∫—Ç—ã }}</p>
            <p><b>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</b> {{ ad.–¥–∞—Ç–∞_—Å–æ–∑–¥–∞–Ω–∏—è|date:"d.m.Y H:i" }}</p>
			{% with det=ad.–≥–∏–¥_–¥–µ—Ç–∞–ª–∏ %}
			<p><b>–¢–∏–ø –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è:</b> {{ det.—Ç–∏–ø_–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è }}</p>
			<p><b>–û–ø—ã—Ç:</b> {{ det.–æ–ø—ã—Ç }}</p>
			<p><b>–í–æ–∑—Ä–∞—Å—Ç:</b> {{ det.–≤–æ–∑—Ä–∞—Å—Ç }}</p>
		  {% endwith %}
		  {% if ad.–æ–ø–∏—Å–∞–Ω–∏–µ %}
			<div style="margin-top:10px;">{{ ad.–æ–ø–∏—Å–∞–Ω–∏–µ }}</div>
		  {% endif %}
        </div>
      </div>
	</div>  

     

      {# --- –û—Ç–∑—ã–≤—ã --- #}
	<div class="tab-content" id="tab-reviews" style="display:none;">
	  <h2>–û—Ç–∑—ã–≤—ã</h2>
	  <ul>
		{% for –∫–æ–º in –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ %}
		  <li>
			<b>{{ –∫–æ–º.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.username }}</b>
			({{ –∫–æ–º.–¥–∞—Ç–∞_—Å–æ–∑–¥–∞–Ω–∏—è|date:"d.m.Y H:i" }}):
			{{ –∫–æ–º.—Ç–µ–∫—Å—Ç }}
			{% if user.is_superuser %}
			  <form method="post" action="{% url 'delete_comment' –∫–æ–º.id %}" style="display:inline;">
				{% csrf_token %}
				<button type="submit" class="btn-danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?');">–£–¥–∞–ª–∏—Ç—å</button>
			  </form>
			{% endif %}
		  </li>
		{% empty %}
		  <li><i>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤.</i></li>
		{% endfor %}
	  </ul>
	  {% if user.is_authenticated %}
		<form method="post" action="{% url 'add_comment' ad.pk %}">
		  {% csrf_token %}
		  {{ form.as_p }}
		  <button type="submit" class="btn-main">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
		</form>
	  {% endif %}
	</div>




		{% if ad.author == user or user.is_superuser %}
		  <a href="{% url 'edit_ad' ad.pk %}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
		  <a href="{% url 'delete_ad' ad.pk %}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
		  {% if ad.is_active %}
			<form method="post" action="{% url 'mark_inactive' ad.pk %}" style="display:inline;">
			  {% csrf_token %}
			  <button type="submit" class="btn-danger" onclick="return confirm('–°–¥–µ–ª–∞—Ç—å –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–º?');">
				–ë–æ–ª—å—à–µ –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ
			  </button>
			</form>
		  {% else %}
			<span style="color: #888; font-weight: bold;">(–ù–µ–∞–∫—Ç—É–∞–ª—å–Ω–æ)</span>
		  {% endif %}
		{% endif %}

      {# ‚Äî JS –¥–ª—è —Ç–∞–±–æ–≤ ‚Äî #}
      <script>
        document.addEventListener('DOMContentLoaded', function(){
          const tabs = document.querySelectorAll('.tab-btn');
          const panes = document.querySelectorAll('.tab-content');
          tabs.forEach(btn=>{
            btn.addEventListener('click', ()=>{
              tabs.forEach(b=>b.classList.remove('active'));
              btn.classList.add('active');
              panes.forEach(p=>{
                p.style.display = p.id === 'tab-'+btn.dataset.tab ? '' : 'none';
              });
            });
          });
        });
      </script>

    {% else %}
	   <h1>{{ ad.–∑–∞–≥–æ–ª–æ–≤–æ–∫ }}</h1>
      {# ‚Äî –í—ã–≤–æ–¥ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚Äî #}
      {% if ad.–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ %}
		  <img src="{{ ad.–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ_url }}" alt="–§–æ—Ç–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è" id="main-image" style="max-width:350px; cursor:zoom-in;" draggable="false">
	  {% endif %}
      
	  
	  
	  {% if user.is_authenticated %}
		<form method="post" action="{% url 'toggle_favorite' ad.pk %}">
		  {% csrf_token %}
		  {% if user in ad.–∏–∑–±—Ä–∞–Ω–Ω–æ–µ.all %}
			<button class="btn-main" type="submit">‚òÖ –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º</button>
		  {% else %}
			<button class="btn-main" type="submit">‚òÜ –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
		  {% endif %}
		</form>
	  {% endif %}
	  
	  
	  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ö–ê–†–¢–ò–ù–ö–ò -->
	<div id="img-modal" style="
		display:none;
		position:fixed;
		z-index:10000;
		left:0; top:0; width:100vw; height:100vh;
		background:rgba(0,0,0,0.85);
		align-items:center; justify-content:center;">
	  <span id="close-modal" style="
		  position:absolute;
		  top:30px; right:50px;
		  font-size:44px; color:white; cursor:pointer;">&times;</span>
	  <img id="img-modal-content" src=""
		   style="max-width:90vw; max-height:85vh; box-shadow:0 8px 32px #000;">
	</div>
	  
	<script>
	document.addEventListener('DOMContentLoaded', function(){
	  var img = document.getElementById('main-image');
	  var modal = document.getElementById('img-modal');
	  var modalImg = document.getElementById('img-modal-content');
	  var closeBtn = document.getElementById('close-modal');
	  if(img){
		img.onclick = function(){
		  modal.style.display = 'flex';
		  modalImg.src = img.src;
		}
	  }
	  if(closeBtn){
		closeBtn.onclick = function(){
		  modal.style.display = 'none';
		  modalImg.src = "";
		}
	  }
	  modal.onclick = function(e){
		if(e.target === modal) {
		  modal.style.display = 'none';
		  modalImg.src = "";
		}
	  }
	});
	</script>
	  
	  
	  
      <div class="ad-meta"> –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ ad.–∫–∞—Ç–µ–≥–æ—Ä–∏—è.–Ω–∞–∑–≤–∞–Ω–∏–µ }}
      </div>
      <div class="ad-meta">
        –ê–≤—Ç–æ—Ä: <a href="{% url 'user_profile' ad.author.username %}">{{ ad.author.username }}</a>
      </div>


      {% if ad.–∫–∞—Ç–µ–≥–æ—Ä–∏—è.–Ω–∞–∑–≤–∞–Ω–∏–µ == "–ü–æ—Ö–æ–¥" and ad.–ø–æ—Ö–æ–¥_–¥–µ—Ç–∞–ª–∏ %}
        {% with det=ad.–ø–æ—Ö–æ–¥_–¥–µ—Ç–∞–ª–∏ %}
          {# —Ç—É—Ç —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ det.—Ä–µ–≥–∏–æ–Ω #}
          <div class="ad-meta"><b>–†–µ–≥–∏–æ–Ω:</b> {{ ad.—Ä–µ–≥–∏–æ–Ω }}</div>
          <div class="ad-meta"><b>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–æ—Ö–æ–¥–∞:</b> {{ det.–¥–∞—Ç–∞_–Ω–∞—á–∞–ª–∞ }}</div>
		  <div class="ad-meta"><b>–î–ª–∏–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞:</b> {{ det.–¥–ª–∏–Ω–∞_–º–∞—Ä—à—Ä—É—Ç–∞ }} –∫–º</div>
		  <div class="ad-meta"><b>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</b> {{ det.—Å–ª–æ–∂–Ω–æ—Å—Ç—å }}</div>
		  <div class="ad-meta"><b>–†–∞–∑–º–µ—Ä –≥—Ä—É–ø–ø—ã:</b> {{ det.—Ä–∞–∑–º–µ—Ä_–≥—Ä—É–ø–ø—ã }}</div>
		  <div class="ad-meta"><b>–¢–∏–ø –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è:</b> {{ det.—Ç–∏–ø_–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è }}</div>
		  <div class="ad-meta"><b>–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å:</b> {{ det.—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å }}</div>
		  <div class="ad-meta"><b>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</b> {{ det.—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è }}</div>
		  <div class="ad-meta"><b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> {{ det.—Å—Ç–æ–∏–º–æ—Å—Ç—å }} —Ä—É–±.</div>
		  <div class="ad-meta"><b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b> {{ ad.–∫–æ–Ω—Ç–∞–∫—Ç—ã }}</div>
		  <div class="ad-meta"><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {{ ad.–æ–ø–∏—Å–∞–Ω–∏–µ }}</div>
		  
        {% endwith %}
		
	{% elif ad.–∫–∞—Ç–µ–≥–æ—Ä–∏—è.–Ω–∞–∑–≤–∞–Ω–∏–µ == "–°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ" and ad.—Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ_–¥–µ—Ç–∞–ª–∏ %}
		{% with det=ad.—Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ_–¥–µ—Ç–∞–ª–∏ %}
			<div class="ad-desc"><b>–†–µ–≥–∏–æ–Ω:</b> {{ ad.—Ä–µ–≥–∏–æ–Ω }}</div>
			<div class="ad-desc"><b>–í–µ—Å:</b> {{ det.–≤–µ—Å }} –≥</div>
			<div class="ad-desc"><b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> {{ det.—Å—Ç–æ–∏–º–æ—Å—Ç—å }} —Ä—É–±.</div>
			<div class="ad-desc"><b>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</b> {{ ad.–∫–æ–Ω—Ç–∞–∫—Ç—ã }}</div>
			<div class="ad-desc"><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {{ ad.–æ–ø–∏—Å–∞–Ω–∏–µ }}</div>
		{% endwith %}
	{% endif %} <br>
	
		
      
		<div class="ad-date">
			–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: {{ ad.–¥–∞—Ç–∞_—Å–æ–∑–¥–∞–Ω–∏—è|date:"d.m.Y H:i" }}
        </div>
		
		<br>
		<br>
      <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
      <ul>
		  {% for –∫–æ–º in –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ %}
			<li>
			  <b>{{ –∫–æ–º.–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.username }}</b>
			  ({{ –∫–æ–º.–¥–∞—Ç–∞_—Å–æ–∑–¥–∞–Ω–∏—è|date:"d.m.Y H:i" }}):
			  {{ –∫–æ–º.—Ç–µ–∫—Å—Ç }}
			  {% if user.is_superuser %}
				<form method="post" action="{% url 'delete_comment' –∫–æ–º.id %}" style="display:inline;">
				  {% csrf_token %}
				  <button type="submit" class="btn-danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?');">–£–¥–∞–ª–∏—Ç—å</button>
				</form>
			  {% endif %}
			</li>
		  {% empty %}
			<li><i>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</i></li>
		  {% endfor %}
		</ul>
		 {% if user.is_authenticated %}
			<form method="post" action="{% url 'add_comment' ad.pk %}">
			  {% csrf_token %}
			  {{ form.as_p }}
			  <button type="submit" class="btn-main">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
			</form>
		  {% endif %}
		</div>




	{% if user.is_authenticated and ad.author == user  %}
	<div class="ad-actions" style="margin: 16px 0;">
		<a href="{% url 'edit_ad' ad.pk %}" class="btn-main">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
		<a href="{% url 'delete_ad' ad.pk %}" class="btn-danger"
		  onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?');">–£–¥–∞–ª–∏—Ç—å
		</a>
	</div>
	{% endif %}
	{% endif %}
  </div>
{% endblock %}
