{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</title>
  <link rel="stylesheet" href="{% static 'board/style.css' %}">
</head>
<body>


<div class="container">
  <div class="top-bar">
    <div class="user-block">
      {% if user.is_authenticated %}
        <div class="user-greet-big">
          <span class="greet-bold">–ü—Ä–∏–≤–µ—Ç, <a href="{% url 'user_profile' user.username %}">{{ user.username }}</a>!</span>
          <form method="post" action="{% url 'logout' %}" style="display:inline;">
            {% csrf_token %}
            <button class="logout-link" type="submit">–í—ã–π—Ç–∏</button>
          </form>
        </div>
        <a href="{% url 'add_ad' %}" class="btn-main add-ad-btn" style="margin-top:14px;">+ –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
      {% endif %}
    </div>
    <div class="user-actions-row">
      {% if user.is_authenticated %}
        <a href="{% url 'my_ads' %}" class="btn-dark">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</a>
        <a href="{% url 'favorites' %}" class="btn-dark">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
      {% else %}
        <a href="{% url 'login' %}" class="btn-main login-btn">–í—Ö–æ–¥</a>
        <a href="{% url 'signup' %}" class="btn-main signup-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
      {% endif %}
    </div>
  </div>


  
  

  <h1>–°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h1>
  
  <form method="get" class="filter-form">
    <div class="filter-row">
      <input type="text" name="q" value="{{ request.GET.q  }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ –æ–ø–∏—Å–∞–Ω–∏—é‚Ä¶">
	  <button type="submit" class="btn-main">–ò—Å–∫–∞—Ç—å</button>
	</div>
	
	
	
	<div class="categories-list" style="margin-bottom: 24px;">
		<a href="{% url 'index' %}?{% if request.GET.q %}q={{ request.GET.q }}{% endif %}"
		   class="category-btn{% if not request.GET.category %} active{% endif %}">–í—Å–µ</a>
		{% for c in –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ %}
		  <a href="?category={{ c.id }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
			 class="category-btn{% if request.GET.category == c.id|stringformat:'s' %} active{% endif %}">
			{{ c.–Ω–∞–∑–≤–∞–Ω–∏–µ }}
		  </a>
		{% endfor %}
	  </div>
  
	
	<input type="hidden" name="category" id="category-hidden" value="{{ request.GET.category }}">
	
	<!-- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–ò–õ–¨–¢–†–´ –î–õ–Ø –ü–û–•–û–î–ê -->
  <div id="hike-fields" style="display:none;">
    <div class="filter-row">
      <label>–†–µ–≥–∏–æ–Ω:</label>
      <select name="region">
        <option value="">–õ—é–±–æ–π</option>
        {% for r in regions %}
          <option value="{{ r }}" {% if r == request.GET.region %}selected{% endif %}>{{ r }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="filter-row">
      <label>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
      <select name="difficulty">
        <option value="">–õ—é–±–∞—è</option>
        {% for d in difficulties %}
          <option value="{{ d }}" {% if d == request.GET.difficulty %}selected{% endif %}>{{ d }}</option>
        {% endfor %}
      </select>
    </div>
	
    <div class="filter-row">
      <label>–¢–∏–ø –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è:</label>
      <select name="trip_type">
        <option value="">–õ—é–±–æ–π</option>
        <option value="–ü–µ—à–∏–π" {% if request.GET.trip_type == "–ü–µ—à–∏–π" %}selected{% endif %}>–ü–µ—à–∏–π</option>
        <option value="–õ—ã–∂–Ω—ã–π" {% if request.GET.trip_type == "–õ—ã–∂–Ω—ã–π" %}selected{% endif %}>–õ—ã–∂–Ω—ã–π</option>
        <option value="–í–æ–¥–Ω—ã–π" {% if request.GET.trip_type == "–í–æ–¥–Ω—ã–π" %}selected{% endif %}>–í–æ–¥–Ω—ã–π</option>
        <option value="–ì–æ—Ä–Ω—ã–π" {% if request.GET.trip_type == "–ì–æ—Ä–Ω—ã–π" %}selected{% endif %}>–ì–æ—Ä–Ω—ã–π</option>
      </select>
    </div>
    <div class="filter-row">
      <label>–°—Ç–æ–∏–º–æ—Å—Ç—å:</label>
      <select name="cost">
        <option value="">–õ—é–±–∞—è</option>
        <option value="0-1000" {% if request.GET.cost == "0-1000" %}selected{% endif %}>0-1000</option>
        <option value="1000-3000" {% if request.GET.cost == "1000-3000" %}selected{% endif %}>1000-3000</option>
        <option value="3000-10000" {% if request.GET.cost == "3000-10000" %}selected{% endif %}>3000-10000</option>
        <option value="10000-999999" {% if request.GET.cost == "10000-999999" %}selected{% endif %}>10000+</option>
      </select>
    </div>
  </div>
  
  
  <!-- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–ò–õ–¨–¢–†–´ –î–õ–Ø –ì–ò–î–ê -->
	<div id="guide-fields" style="display:none;">
	  <div class="filter-row">
		<label>–¢–∏–ø –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è:</label>
		<select name="guide_trip_type">
		  <option value="">–õ—é–±–æ–π</option>
		  <option value="–ü–µ—à–∏–π" {% if request.GET.guide_trip_type == "–ü–µ—à–∏–π" %}selected{% endif %}>–ü–µ—à–∏–π</option>
		  <option value="–õ—ã–∂–Ω—ã–π" {% if request.GET.guide_trip_type == "–õ—ã–∂–Ω—ã–π" %}selected{% endif %}>–õ—ã–∂–Ω—ã–π</option>
		  <option value="–í–æ–¥–Ω—ã–π" {% if request.GET.guide_trip_type == "–í–æ–¥–Ω—ã–π" %}selected{% endif %}>–í–æ–¥–Ω—ã–π</option>
		  <option value="–ì–æ—Ä–Ω—ã–π" {% if request.GET.guide_trip_type == "–ì–æ—Ä–Ω—ã–π" %}selected{% endif %}>–ì–æ—Ä–Ω—ã–π</option>
		</select>
	  </div>
	</div>


    {% if request.GET.category %}
	  {% for c in –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ %}
		{% if c.id|stringformat:'s' == request.GET.category %}
		  {% if c.–Ω–∞–∑–≤–∞–Ω–∏–µ == "–ü–æ—Ö–æ–¥" or c.–Ω–∞–∑–≤–∞–Ω–∏–µ == "–ì–∏–¥" %}
			<div class="filter-row">
			  <button type="submit" class="btn-main">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
			  <a href="{% url 'index' %}" class="link">–°–±—Ä–æ—Å–∏—Ç—å</a>
			</div>
		  {% endif %}
		{% endif %}
	  {% endfor %}
	{% endif %}



  {% for ad in –æ–±—ä—è–≤–ª–µ–Ω–∏—è %}
  <div class="ad-card">
    {% if ad.–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ %}
	  <img src="{{ ad.–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.url }}" alt="" class="ad-list-img" style="cursor:zoom-in;" draggable="false">
	{% endif %}

    <div class="ad-card-content">
      <a href="{% url 'ad_detail' ad.pk %}" class="ad-title">{{ ad.–∑–∞–≥–æ–ª–æ–≤–æ–∫ }}</a>
      <div class="ad-meta">
        {{ ad.–∫–∞—Ç–µ–≥–æ—Ä–∏—è.–Ω–∞–∑–≤–∞–Ω–∏–µ }}  <br>
        –ê–≤—Ç–æ—Ä: <a href="{% url 'user_profile' ad.author.username %}">{{ ad.author.username }}</a> |  –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:
        {{ ad.–¥–∞—Ç–∞_—Å–æ–∑–¥–∞–Ω–∏—è|date:"d.m.Y" }}
      </div>
      

      {# –ö–Ω–æ–ø–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∞ –∏–ª–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #}
      {% if ad.author == user or user.is_superuser %}
        <a href="{% url 'edit_ad' ad.pk %}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a href="{% url 'delete_ad' ad.pk %}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
      {% endif %}
    </div>
  </div>
{% empty %}
  <p><i>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</i></p>
{% endfor %}

<div id="img-modal" style="display:none; position:fixed; z-index:10000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.85); align-items:center; justify-content:center;">
  <span id="close-modal" style="position:absolute; top:30px; right:50px; font-size:44px; color:white; cursor:pointer;">&times;</span>
  <img id="img-modal-content" src="" style="max-width:90vw; max-height:85vh; box-shadow:0 8px 32px #000;">
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  function toggleExtraFields() {
    let activeBtn = document.querySelector('.category-btn.active');
    let val = activeBtn ? activeBtn.textContent.trim() : '';
    document.getElementById('hike-fields').style.display = (val === '–ü–æ—Ö–æ–¥') ? '' : 'none';
    document.getElementById('guide-fields').style.display = (val === '–ì–∏–¥') ? '' : 'none';
  }
  toggleExtraFields();

  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      setTimeout(toggleExtraFields, 100); // –¥–æ–∂–¥–∞—Ç—å—Å—è —Å–º–µ–Ω—ã active-–∫–ª–∞—Å—Å–∞
    });
  });

  // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ —É–∂–µ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
  toggleExtraFields();
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function(){
  var modal = document.getElementById('img-modal');
  var modalImg = document.getElementById('img-modal-content');
  var closeBtn = document.getElementById('close-modal');
  // –î–ª—è –≤—Å–µ—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫-–æ–±—ä—è–≤–ª–µ–Ω–∏–π
  document.querySelectorAll('.ad-list-img').forEach(function(img){
    img.onclick = function(){
      modal.style.display = 'flex';
      modalImg.src = img.src;
    }
  });
  if(closeBtn){
    closeBtn.onclick = function(){
      modal.style.display = 'none';
      modalImg.src = "";
    }
  }
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
  modal.onclick = function(e){
    if(e.target === modal) {
      modal.style.display = 'none';
      modalImg.src = "";
    }
  }
});
</script>

</body>
</html>
